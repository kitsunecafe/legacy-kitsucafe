{
    "componentChunkName": "component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js",
    "path": "/blog/45dr-postmortem/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Kitsune Cafe","social":[{"name":"twitter","url":"https://twitter.com/GrumpyMochan"},{"name":"github","url":"https://github.com/mochancrimthann"},{"name":"itchio","url":"https://mochancrimthann.itch.io/"},{"name":"steam","url":"https://steamcommunity.com/id/samsamsamoyed"}]}},"blogPost":{"id":"ca72d51b-b714-5e60-8d1e-3259aefa3812","excerpt":"I worked on a Roguelike game from 8 March 2022 to 22 April 2022. My motivations were to teach myself new things, develop my existing skills…","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"45 Day Roguelike Postmortem\",\n  \"date\": \"2022-04-22T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"I worked on a Roguelike game from 8 March 2022 to 22 April 2022. My motivations were to teach myself new things, develop my existing skills, and have fun with the development process. Two out of three isn\\u2019t bad. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://mochancrimthann.itch.io/45dr\"\n  }, \"Give it a try.\")), mdx(\"p\", null, \"Starting a new project is always exciting, so I put in many hours in the first couple of weeks. There\\u2019s no shortage of inspiring roguelike games, but most of my inspiration was directly from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://crawl.develz.org/\"\n  }, \"DCSS\"), \". I completed procedural generation, movement, tile visibility, combat, items, enemy AI, and a character controller within the first week and a half. Most of the development was straightforward to reason. I decided early in development to create a new component for each feature to avoid breaking previous ones. Nothing drains my motivation like a week-long bug-fixing marathon.\"), mdx(\"p\", null, \"My method of generating a dungeon level was disappointingly simple: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://en.wikipedia.org/wiki/Binary_space_partitioning\"\n  }, \"binary space partitioning\"), \". BSP will determine whether a space can be split in half and then randomly split it vertically or horizontally. Repeat this until the space is sufficiently divided, determine how much of that space to use, then connect it to others with corridors. I separated the logic for generating the space of the dungeon and displaying the dungeon into two separate components: Dungeon Generator and Dungeon Renderer. The renderer is responsible for waiting for the generator to finish and then rendering the tiles onto a Unity tilemap.\"), mdx(\"p\", null, \"The field of view (FOV) system is simple as well. This system uses another tilemap for rendering visibility. Each tile initializes to black with full opacity (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"RGBA(0, 0, 0, 1)\"), \"). The opacity value will change to 0.5 or 0 depending on visibility.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"300px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"33.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVQoz33RsaqCUBgHcDenWnSqR/AlegSfo8HRpDSlyKEwG4Jq6AWMJok2EXHKWcQxUHBpy0nsH+dcrlxvl/vBx9ED58ef72MYhsHv7na7GI1GmM1mmE6nmEwmUFWV9nq9RlmW+Fmv16s5GQKwLAue5z9AwzAwn89xOByw2+0oTsDn80mB+/2OoihaKAUFQcBwOGyBiqLQZMfjEUEQYLPZQNM0WJaFqqqQZRkulwtc18Xj8fhMKIriR8LxeIzVagXHcXA6naDrOv0nFYYh8jzH7XZDkiT0rq7rL7DX60GSJHQ6nQYk2H6/h2maNJXneVgsFhQkD9M0he/7uF6vFG4l7Pf7GAwG4DiuBZK5LZdLnM9nbLdbemfbdrOUKIoQx3GDNeBfW5Zlmc6MNJnn9/d/Wyb1BiaBatScTYClAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Tile opacity values\",\n    \"title\": \"Tile opacity values\",\n    \"src\": \"/static/7c4d47936c18eed5a8966d9342a8a338/5a46d/values.png\",\n    \"srcSet\": [\"/static/7c4d47936c18eed5a8966d9342a8a338/5a46d/values.png 300w\"],\n    \"sizes\": \"(max-width: 300px) 100vw, 300px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"When the target entity\\u2019s FOV updates each turn, the visibility tilemap checks a target\\u2019s FOV. I used a C# \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"HashSet\"), \" of coordinates to represent each entity\\u2019s FOV. The visibility system monitors a target\\u2019s FOV and sets each visible tile\\u2019s opacity to 0. Previously visible tiles\\u2019 opacities are then set to 0.5. Determining which tiles were previously visible is as simple as taking the difference between the last turn\\u2019s visible tiles and this turn\\u2019s visible tiles (Previous - Current).\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"600px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75.07246376811594%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByElEQVQ4y62UyY6BQRSFPaqIIcaFjUTEA3gIYm3Nhg2WEjGTEIIEETHP0+k+N6ny+1v3qv/kRKnhq3Pr1i0Lvr/n8ylS7cfjgfv9LmJbjf31KYbFOJmLf5vMscPhgOPxiP1+L7per1gul9hut3qeBirY6XRCqVRCJpNBLpfDYDDQYEKm0yl6vZ5oNpthsVhgt9vpKCxGWKPRQCQSgcPhgNVqhc1mg8fjQSKRECfj8Vjm1Ot1rX6/j/P5/HKoYN1uVxY7nU74/X4EAgER+6h8Po9ms4larSZQpWq1Kv0KalHhxGIx2O12gXi9XhHBdBuPx2VDM4wijNDRaPQCTiYTAfl8vjcRyN9sNotOp/MWqlHcqN1uy60QIP9wcTQalTMMh8MIBoMIhUKiYrGIVqsljpgwhs8+tqlyuazD1g4JVGennFEMndk2OmSIdEWpPm6oHf7rGRqz7Ha7f2SZfcYs0405y3T3lmUF5QDP0eVyyR2kY4adTCaxWq0wHA7FJSGVSkXaNMLq+Vgpt9tNbn6hUEAqlUI6nRYXLDn1sSrm87los9m8vQHi0FjLrMn1ei32Waeqfrn4crn8+TBoh+bXxvx6fOozyzj2BU0GC51DTCd4AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Venn diagram of opacity values\",\n    \"title\": \"Venn diagram of opacity values\",\n    \"src\": \"/static/d76be52a5e8673841be6b9fc2c417ead/0a47e/opacity-venn.png\",\n    \"srcSet\": [\"/static/d76be52a5e8673841be6b9fc2c417ead/e4d6b/opacity-venn.png 345w\", \"/static/d76be52a5e8673841be6b9fc2c417ead/0a47e/opacity-venn.png 600w\"],\n    \"sizes\": \"(max-width: 600px) 100vw, 600px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Once the dungeon finishes generating, all \\u201Cdecorators\\u201D are notified and begin placing objects through the dungeon. Decorators include the player, enemies, stairs, and treasure chests. These components became a dumping ground for hacky code and workarounds, so I tried to ensure this code didn\\u2019t influence any other systems.\"), mdx(\"p\", null, \"Procedural item generation took far and away the most amount of time for a disproportionately small payoff. The base item is simple: it\\u2019s just a list of attributes. Any system which interacts with items queries this list. Moving all the behavior out of the items and into relevant systems allows for more contextual behavior. The idea is that items were naive containers of data, not unlike an ECS entity, and different systems would handle items differently. I wish I had adopted more of an ECS approach with how effective the items were.\"), mdx(\"p\", null, \"As an example of the item and attribute system, I\\u2019ll use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DamageAttribute\"), \". It extends a base attribute called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ItemAttribute\"), \" which has a few overridable properties: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Label\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EditorDescription\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Description\"), \". It also has a string value to accept a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://en.wikipedia.org/wiki/Dice_notation\"\n  }, \"dice notation\"), \" value representing the damage. The string gets parsed into a custom \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dice\"), \" object. The combat system queries all relevant items from the attacker and defender (namely, the attacker\\u2019s weapon(s) and the defender\\u2019s armor(s)). It rolls the attacker\\u2019s hit value versus the defender\\u2019s armor class (AC) to determine whether the hit connects. If the hit connects, it rolls all damage dice (by querying every item\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DamageAttribute\"), \"). Once the damage is determined, it queries the defender\\u2019s highest level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IDamageHandler\"), \" and tells it to apply the damage. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IDamageHandler\"), \" is an interface that allows multiple sources of defense to handle incoming damage in a layered way (for example, AC -> elemental resistances -> physical resistances -> health).\"), mdx(\"p\", null, \"I may have overengineered it a bit given how small the game is, but working with items and their attributes was very easy and let me develop complex systems around them with very little friction. The biggest time-sink was getting Unity to cooperate with these objects. This approach \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"requires\"), \" custom editor scripts to use their maximum effectiveness. Writing editor scripts for a small game isn\\u2019t exactly how I wanted to spend my time. I could have probably used \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://unity.com/dots\"\n  }, \"Unity\\u2019s DOTS\"), \" framework, but I\\u2019ve struggled with that before and didn\\u2019t want to try again. I\\u2019ve made and used ECS frameworks before, but Unity\\u2019s strikes me as needlessly complicated.\"), mdx(\"p\", null, \"The UI was rushed at times and required me to rewrite it a few times. Thankfully it was kept minimal, so most of the rewrites didn\\u2019t take much longer than half an hour. I think I\\u2019ll pick up a UI framework and use that in the future.\"), mdx(\"p\", null, \"To my surprise, the most common question and feedback I received was about the \\u201C(worn)\\u201D tag that\\u2019s affixed to equipped items. Many people thought it was related to a durability system which makes sense in retrospect \\u2014 you can\\u2019t \\u201Cwear\\u201D a sword. The reason for using \\u201Cworn\\u201D rather than \\u201Cequipped\\u201D was that I\\u2019d frequently seen it used in this context, and I wanted to maximize character space for item names. Thanks to everyone who caught this \\u2014 it is small but valuable feedback.\"), mdx(\"p\", null, \"It\\u2019s too early to say if I want to come back and work on this game. I learned a lot from this experience, and I\\u2019m glad I did it. I\\u2019m thinking of writing articles on exactly how I implemented certain aspects of the game, so let me know if this would be valuable to you.\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/blog/45dr-postmortem/","title":"45 Day Roguelike Postmortem","tags":[],"date":"April 22, 2022","image":null,"imageAlt":null,"imageCaptionText":null,"imageCaptionLink":null,"socialImage":null},"previous":{"id":"ffed57fd-1c9b-52ae-9749-8dd6e72919eb","excerpt":"Unity offers a range of convenient ways to manipulate and hack its inspector. Unfortunately, thanks to the size of Unity's documentation…","slug":"/blog/convenient-unity-attributes/","title":"Convenient Unity Attributes","date":"December 09, 2021"},"next":null},"pageContext":{"id":"ca72d51b-b714-5e60-8d1e-3259aefa3812","previousId":"ffed57fd-1c9b-52ae-9749-8dd6e72919eb","maxWidth":1380}},
    "staticQueryHashes": ["1083777997","2554972630","2744905544","3090755652","764694655"]}