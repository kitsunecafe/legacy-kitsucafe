{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/blog/simplifying-code-with-components/","result":{"data":{"site":{"siteMetadata":{"title":"Kitsune Cafe","social":[{"name":"discord","url":"https://discord.com/invite/jNFSXm5kXd"},{"name":"mastodon","url":"https://mastodon.gamedev.place/@kitsunecafe"},{"name":"github","url":"https://github.com/kitsunecafe"},{"name":"itchio","url":"https://kitsunecafe.itch.io/"},{"name":"steam","url":"https://steamcommunity.com/id/samsamsamoyed"}]}},"blogPost":{"id":"fe799307-9485-538e-a9dc-66733b4abe13","excerpt":"Unity is a component-based game engine. Without any context, \"component\" is a nebulous and vague term. Understanding what a component  isâ€¦","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Simplifying Code with Components\",\n  \"date\": \"2021-12-05T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Unity is a component-based game engine. Without any context, \\u201Ccomponent\\u201D is a nebulous and vague term. Understanding what a component \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"is\"), \" becomes crucial to understanding Unity. In Unity\\u2019s \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.unity3d.com/Manual/Components.html\"\n  }, \"Introduction to components\"), \", they provide an unsatisfactory definition of a component.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Components define the behaviour of that GameObject.\")), mdx(\"p\", null, \"While this is entirely accurate, especially within the context of Unity, it fails to provide a good idea of the fundamental concepts behind components.\"), mdx(\"h1\", {\n    \"id\": \"what-is-a-component\"\n  }, \"What is a component?\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://gameprogrammingpatterns.com/component.html\"\n  }, \"Game Programming Pattern\"), \"\\u2019s definition provides more insight into the purpose of a component.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Allow a single entity to span multiple domains without coupling the domains to each other.\")), mdx(\"p\", null, \"Without reading further into the article, I find the definition sterile and hard to visualize. That said, I would highly recommend reading the rest article and the entirety of the book - it\\u2019s worth it!\"), mdx(\"p\", null, \"I\\u2019ll make an effort to define a component as well.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"A component is a single, reusable domain behavior with an intuitive interface. \")), mdx(\"p\", null, \"As much as possible, a component should attempt to focus on a single behavior within a single domain. It should have a clear and simple interface to allow its entity, other entities, and other components to interact with its behavior.\"), mdx(\"p\", null, \"I find that Unity\\u2019s \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.unity3d.com/ScriptReference/CharacterController.html\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"CharacterController\")), \" is an example of a good component. It exposes two public methods, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.unity3d.com/ScriptReference/CharacterController.Move.html\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"Move(Vector3)\")), \" and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.unity3d.com/ScriptReference/CharacterController.SimpleMove.html\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"SimpleMove(Vector3)\")), \".\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Move(Vector3 motion)\"), \" \\u201Csupplies the movement of a GameObject with an attached CharacterController component.\\u201D It takes the desired movement vector and attempts to displace the GameObject to which it is attached. It makes no assumptions about gravity since different games have different requirements for gravity.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleMove(Vector3 speed)\"), \" \\u201Cmoves the character with speed.\\u201D Speed is a movement vector \\u2014 a direction and speed to move per second. This method \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"does\"), \" make assumptions about gravity.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CharacterController\"), \" hides the complexity of ground collision, physics interactions, and movement interpolation. Additionally, the two methods hide or reveal certain complexities about how the component moves the character. Certain Unity-isms regarding Collision events notwithstanding, the interface is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"very\"), \" simple and obvious.\"), mdx(\"h1\", {\n    \"id\": \"when-should-i-create-a-new-component\"\n  }, \"When should I create a new component?\"), mdx(\"p\", null, \"The obvious answer is whenever you need a new behavior. If you\\u2019re unsure, it is always possible and encouraged to review and refactor code to identify the need for abstractions like a new component.\"), mdx(\"p\", null, \"Using movement as an example again, should character rotation be part of the character movement component? The two often occur simultaneously and even rely on one another. It makes sense to combine rotation and displacement into the same behavior. There are likely cases where this may not be true, and in that instance, the developer should split them into separate components.\"), mdx(\"p\", null, \"Should jumping be included in the movement component? I can imagine many scenarios where an entity would need to move but not jump. In those cases, it makes sense to separate them into different components.\"), mdx(\"p\", null, \"I obviously won\\u2019t iterate every possible decision on whether or not I would personally separate a behavior into a new component. It\\u2019s important to make thoughtful decisions about your code architecture, similar to the examples above.\"), mdx(\"h1\", {\n    \"id\": \"making-a-movement-component\"\n  }, \"Making a movement component\"), mdx(\"p\", null, \"Let\\u2019s use Unity\\u2019s \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.unity3d.com/ScriptReference/CharacterController.Move.html\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"CharacterController.Move\")), \" example.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"using System.Collections;\\nusing System.Collections.Generic;\\nusing UnityEngine;\\n\\npublic class Example : MonoBehaviour\\n{\\n    private CharacterController controller;\\n    private Vector3 playerVelocity;\\n    private bool groundedPlayer;\\n    private float playerSpeed = 2.0f;\\n    private float jumpHeight = 1.0f;\\n    private float gravityValue = -9.81f;\\n\\n    private void Start()\\n    {\\n        controller = gameObject.AddComponent<CharacterController>();\\n    }\\n\\n    void Update()\\n    {\\n        groundedPlayer = controller.isGrounded;\\n        if (groundedPlayer && playerVelocity.y < 0)\\n        {\\n            playerVelocity.y = 0f;\\n        }\\n\\n        Vector3 move = new Vector3(Input.GetAxis(\\\"Horizontal\\\"), 0, Input.GetAxis(\\\"Vertical\\\"));\\n        controller.Move(move * Time.deltaTime * playerSpeed);\\n\\n        if (move != Vector3.zero)\\n        {\\n            gameObject.transform.forward = move;\\n        }\\n\\n        // Changes the height position of the player..\\n        if (Input.GetButtonDown(\\\"Jump\\\") && groundedPlayer)\\n        {\\n            playerVelocity.y += Mathf.Sqrt(jumpHeight * -3.0f * gravityValue);\\n        }\\n\\n        playerVelocity.y += gravityValue * Time.deltaTime;\\n        controller.Move(playerVelocity * Time.deltaTime);\\n    }\\n}\\n\")), mdx(\"p\", null, \"Although it\\u2019s not relevant, this example goes against Unity\\u2019s advice to not call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Move\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleMove\"), \" more than once per frame.\"), mdx(\"p\", null, \"One of the first things to notice about this component is that it crosses two domains: input and movement. Let\\u2019s start by separating those concerns.\"), mdx(\"h2\", {\n    \"id\": \"separating-concerns\"\n  }, \"Separating concerns\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"public class InputProvider : MonoBehaviour\\n{\\n  public Vector2 CurrentDirection { get; protected set; }\\n  public bool WantsToJump { get; protected set; }\\n\\n  private void Update()\\n  {\\n    CurrentDirection = new Vector2(\\n      Input.GetAxis(\\\"Horizontal\\\"),\\n      Input.GetAxis(\\\"Vertical\\\")\\n    );\\n\\n    WantsToJump = Input.GetButton(\\\"Jump\\\");\\n  }\\n}\\n\")), mdx(\"p\", null, \"It doesn\\u2019t seem like much, but small components like this one help separate unrelated logic to make them more composable.\\nLet\\u2019s refactor the remaining example code.\"), mdx(\"p\", null, \"We\\u2019ll start by renaming the class and the file to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EntityMovement\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EntityMovement.cs\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"public class EntityMovement : MonoBehaviour\\n\")), mdx(\"p\", null, \"Now let\\u2019s add a reference to our new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PlayerInput\"), \" component.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"public class EntityMovement : MonoBehaviour\\n{\\n  private InputProvider input;\\n  // ...\\n\\n  private void Start()\\n  {\\n    //...\\n    input = gameObject.GetComponent<InputProvider>();\\n  }\\n\")), mdx(\"p\", null, \"With our reference to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InputProvider\"), \", we can replace the existing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Input\"), \" references.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"  private void Update()\\n  {\\n    // ...\\n    Vector3 move = new Vector3(input.CurrentDirection.x, 0, input.CurrentDirection.y);\\n    controller.Move(move * Time.deltaTime * playerSpeed);\\n\\n    if (move != Vector3.zero)\\n    {\\n        gameObject.transform.forward = move;\\n    }\\n\\n    if (input.WantsToJump && groundedPlayer)\\n    {\\n        playerVelocity.y += Mathf.Sqrt(jumpHeight * -3.0f * gravityValue);\\n    }\\n    // ..\\n  }\\n\")), mdx(\"p\", null, \"Create a sphere with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EntityMovement\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InputProvider\"), \" components and move it with WASD or the arrow keys. It should operate like Unity\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Example\"), \" component, but now we\\u2019ve separated input handling from movement!\\nUnfortunately, the changes we\\u2019ve made only illustrate the concept of splitting concerns without actually having done anything practical. What \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"would\"), \" be useful is if these components were usable by more than the player character. Let\\u2019s refactor our code to make that possible.\"), mdx(\"h2\", {\n    \"id\": \"making-it-reusable\"\n  }, \"Making it reusable\"), mdx(\"p\", null, \"For our components to be reusable, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InputProvider\"), \" needs to act as a generic interface rather than a thin proxy to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Input\"), \". An easy way to accomplish this would be to refactor \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InputProvider\"), \" as a C# \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"interface\"), \". Thankfully Unity\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GetComponent\"), \" works with classes and interfaces. Be sure to remove \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InputProvider\"), \" from the existing GameObject.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"public interface InputProvider\\n{\\n  Vector2 CurrentDirection { get; }\\n  bool WantsToJump { get; }\\n}\\n\\n\")), mdx(\"p\", null, \"A new component is required to implement the interface, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PlayerInputProvider\"), \". It will contain the implementation details that previously lived in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InputProvider\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-cs\"\n  }, \"public class PlayerInputProvider : MonoBehaviour, InputProvider\\n{\\n  public Vector2 CurrentDirection { get; protected set; }\\n  public bool WantsToJump { get; protected set; }\\n\\n  private void Update()\\n  {\\n    CurrentDirection = new Vector2(\\n      Input.GetAxis(\\\"Horizontal\\\"),\\n      Input.GetAxis(\\\"Vertical\\\")\\n    );\\n\\n    WantsToJump = Input.GetButton(\\\"Jump\\\");\\n  }\\n}\\n\")), mdx(\"p\", null, \"Attach \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PlayerInputProvider\"), \" to the player object and ensure the character moves again. A future component could be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EnemyInputProvider\"), \" which determines movement based on a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NavMeshAgent\"), \". \"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/blog/simplifying-code-with-components/","title":"Simplifying Code with Components","tags":[],"date":"December 05, 2021","image":null,"imageAlt":null,"imageCaptionText":null,"imageCaptionLink":null,"socialImage":null},"previous":{"id":"fe799307-9485-538e-a9dc-66733b4abe13","excerpt":"Unity is a component-based game engine. Without any context, \"component\" is a nebulous and vague term. Understanding what a component  isâ€¦","slug":"/blog/simplifying-code-with-components/","title":"Simplifying Code with Components","date":"December 05, 2021"},"next":{"id":"6316c743-740e-596a-af67-9ff5e8efd41d","excerpt":"Unity offers a range of convenient ways to manipulate and hack its inspector. Unfortunately, thanks to the size of Unity's documentationâ€¦","slug":"/blog/convenient-unity-attributes/","title":"Convenient Unity Attributes","date":"December 09, 2021"}},"pageContext":{"id":"fe799307-9485-538e-a9dc-66733b4abe13","nextId":"6316c743-740e-596a-af67-9ff5e8efd41d","maxWidth":1380}},"staticQueryHashes":["1083777997","2554972630","2744905544","3090755652","764694655"]}